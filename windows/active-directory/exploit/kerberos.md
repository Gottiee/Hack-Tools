# Kerberos

Kerberos is an authentication protocol used within Windows Active Directory (AD) environments to verify the identities of users and services. It is based on symmetric key cryptography and works through a ticketing system, which helps to ensure secure authentication and communication within a network.

### Table of content

- [How it work](#how-it-work)
- **Attack**
- [Kerberoasting](#kerberoasting)

## How it Work

- Authentication Service (AS) Request/Response:
    - When a user logs in, their client machine sends a request to the Key Distribution Center (KDC), specifically to the Authentication Service.
    - The KDC verifies the user's credentials and, if valid, issues a Ticket Granting Ticket (TGT). This TGT is encrypted with the user's password hash and can only be decrypted by the KDC.
- Ticket Granting Service (TGS) Request/Response:
    - The client now uses the TGT to request access to a specific service (e.g., a file server) from the Ticket Granting Service (also part of the KDC).
    - The TGS validates the TGT and issues a Service Ticket (ST), which the client can then use to authenticate to the requested service.
- Service Request/Response:
    - The client presents the Service Ticket to the target service.
    - If the ticket is valid, the service grants access to the client.

**Key Components:**

- Key Distribution Center (KDC): The trusted third-party server that issues tickets. It consists of two services:
    - Authentication Service (AS)
    - Ticket Granting Service (TGS)
- Ticket Granting Ticket (TGT): A ticket used to obtain service tickets.
- Service Ticket (ST): A ticket used to access a specific service.

## Kerberoasting

An attack where an attacker requests service tickets for service accounts and attempts to crack them offline.

`GetUserSPNs.py DOMAIN.local/user:password123 -outputfile ticket.txt`